<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>House MD</title>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.2/css/all.css">
    <!-- Bootstrap core CSS -->
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <!-- Material Design Bootstrap -->
    <link href="css/mdb.min.css" rel="stylesheet">
    <!-- Your custom styles (optional) -->
    <link href="css/style.css" rel="stylesheet">
    <link href="style.css" rel="stylesheet">

    <link href="styletab.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-2.1.3.js"
        integrity="sha256-goy7ystDD5xbXSf+kwL4eV6zOPJCEBD1FBiCElIm+U8=" crossorigin="anonymous"></script>

    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/vue/2.6.8/vue.min.js"></script>

    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.6.2/css/bulma.min.css">
    <!-- <script defer src="https://use.fontawesome.com/releases/v5.0.0/js/all.js"></script> -->

    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <script src="https://cdn.datatables.net/1.10.12/js/jquery.dataTables.min.js"></script>

    <link rel="stylesheet" href="https://cdn.datatables.net/1.10.12/css/jquery.dataTables.min.css">
</head>


<body>


    <header>

        <nav class="navbar fixed-top navbar-expand-lg navbar-dark blue-gradient scrolling-navbar"
            style="position: fixed;">
            <a class="navbar-brand" href="#"><img src="img/dashboard/logo.png" style="width: 56px;"></a> <button
                class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
                aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav mr-auto">
                    <li class="nav-item active">
                        <a class="nav-link" href="#">Home <span class="sr-only">(current)</span></a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">Features</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">Pricing</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">Opinions</a>
                    </li>
                </ul>
                <ul class="navbar-nav nav-flex-icons">
                    <li class="nav-item">
                        <a class="nav-link"><i class="fab fa-facebook-f"></i></a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link"><i class="fab fa-twitter"></i></a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link"><i class="fab fa-instagram"></i></a>
                    </li>
                </ul>
            </div>
        </nav>

    </header>


    <div class="tab">
        <button class="tablinks" onclick="openCity(event, 'London')" id="defaultOpen"> <img src="img/dashboard/jimmy.jpg" style="width: 45px;height: 39px;border-radius: 44px;"><span style="margin: 12px;font-size: 16px;">David Grey</span> <a style=" margin: 59px; font-size: 12px;top: -15px; position: relative;">Admin</a></button>
        <a href="dashboard.html"><button class="tablinks" onclick="openCity(event, 'London')" id="defaultOpen">Dashboard<i class="fas fa-home"></i></button></a>
        <a href="servicerequest.html"><button class="tablinks">Providers <i class="fas fa-user-tie"></i></button></a>
        <a href="members.html"> <button class="tablinks">Members <i class="fas fa-users"></i></button></a>
        <a href = "approved.html"> <button class="tablinks" >Approved Providers</button></a>

        <a href="transaction.html"><button class="tablinks">Transaction</button></a> <button class="tablinks">Earnings</button>
        <a href="serviceapplication.html"> <button class="tablinks">Applications</button></a> <a href="service.html"><button class="tablinks">Services</button></a>
    </div>



    <div id="London" class="tabcontent">
        <button type="button" style="margin: 19px;border: 2px solid #3e9cdd;" class="btn btn-rounded btn-lg">Approved Providers<i class="fas fa-scroll"></i></button>
        <p style="float:right;margin: 30px;color: #bb4242;font-size: 14px;">Approved / Providers </p>
        <div class="table-responsive card"  style ="padding: 30px;">
            <table class="table" id="example">
                <thead class = "blue-gradient">
                    <tr>
                        <th id="th">Firt Name</th>
                        <th id="th">Last Name</th>
                        <th id="th">Mobile Number</th>
                        <th id="th">Email</th>
                        <th id="th">Edit</th>
                        <!-- <th id="th">Remove</th> -->
                    </tr>
                </thead>
                <tbody id="hmd-table">
                </tbody>
            </table>
        </div>
    </div>

    <!-- <button class="btn btn blue-gradient btn-rounded "  id = "btnAdd" style = "color: white;
	  position: relative;
	  top: 100px">Add</button></a></td> -->

    <div id="modalRemovebox" class="modal">
        <div class="modal-background"></div>
        <div class="modal-card">
            <header class="modal-card-head blue-gradient">
                <p class="modal-card-title" style="color: white;">Do you want to Delete this?</p>
            </header>
            <div class="modal-card-foot chums-save">
                <button id="removeThis" class="btn blue-gradient btnClose" style="color:white">Yes</button>
                <button id="cancelRemove" class="btn btn-mdb-color btnClose" style="color:white">No</button>
            </div>
        </div>

    </div>


    <div id="modal" class="modal">
        <div class="modal-background"></div>
        <div class="modal-card">
            <header class="modal-card-head blue-gradient">
                <p class="modal-card-title">Person Form</p>
                <!-- <button class="btnClose delete" aria-label="close"></button> -->
            </header>
            <section class="modal-card-body">
                <div class="field">
                    <label class="label">First Name</label>
                    <div class="control">
                        <input type="hidden" id="txtType">
                        <input type="hidden" id="txtKey">
                        <input class="input" id="txtfirstname" type="text" placeholder="Chums ID">
                  </div>
                </div>
                
                <div class="field">
                    <label class="label">Last Name</label>
                    <div class="control">
                        <input class="input" id="txtlastname" type="text" placeholder="username">
                    </div>

                </div>
                <div class="field">
                    <label class="label">Mobile Number</label>
                    <div class="control">
                        <input class="input" id="txtMobilenumber" type="text" placeholder="score">
                    </div>
                </div>

                <div class="field">
                    <label class="label">Email</label>
                    <div class="control">
                        <input class="input" id="txtemail" type="text" placeholder="score">
                    </div>
                </div>

        
            </section>
            <div class="modal-card-foot chums-save">
                <button id="btnSave" class="btn blue-gradient" style="color:white">Save changes</button>
                <!-- <button id="btnSavetime" class="button is-success">Save changes</button> -->
                <button id="btnClose" class="btn btn-mdb-color btnClose" style="color:white">Cancel</button>
            </div>
        </div>

    </div>

    <div id="myModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <p>Some text in the Modal..</p>
        </div>
    </div>


    <!-- <script src="https://code.jquery.com/jquery-2.2.4.min.js"
		integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script> -->
    <script src="https://www.gstatic.com/firebasejs/4.10.0/firebase.js"></script>
    <script>

        // FIREBASE DATABASE CONFIGURATION
        var config = {
            apiKey: "AIzaSyB-QqOCEreJ1Yn9EWb84NdwJ4E-FvKfC7I",
            authDomain: "edok-1c5a9.firebaseapp.com",
            databaseURL: "https://edok-1c5a9.firebaseio.com",
            projectId: "edok-1c5a9",
            storageBucket: "edok-1c5a9.appspot.com",
            messagingSenderId: "628540937215",
            appId: "1:628540937215:web:6d7ad591c271f0d0394dca",
            measurementId: "G-LH94VM5FTM"
        };
        firebase.initializeApp(config);
        var database = firebase.database();


        database.ref('approvedProviders/').on('child_added', function (snapshot) {
            var data = snapshot.val();
            var key = snapshot.key;
            nexkey = parseInt(key) + 1
            $(document).ready(function () {
                $('#example').DataTable();
                var dataTable = $("#example").dataTable().api();
                tr = document.createElement("tr");
                tr.innerHTML = '<tr ><td>' + snapshot.val().firstName + '</td><td>' + snapshot.val().lastName + '</td> <td>' + snapshot.val().mobileNumber + '</td> <td>' + snapshot.val().email + '</td><td><a href="#" data-key="' + key + '" class=" btnEdit"> <button class="btn btn blue-gradient btn-rounded" style = "color:white">Edit</button></a></td></tr>';
                dataTable.row.add(tr);
                dataTable.draw();
            });

        });



        database.ref('approvedProviders/').on('child_changed', function (data) {
            update_data_table(data.val().firstName, data.val().lastName, data.val().mobileNumber, data.val().email, data.key)
        });

        database.ref('approvedProviders/').on('child_removed', function (data) {
            remove_data_table(data.key)
        });

        function add_data_table(firstName, lastName, mobileNumber, email, key) {
            tr.innerHTML = '<tr><td>' + snapshot.val().firstName+ '</td><td>' + snapshot.val().lastName + '</td><td>' + snapshot.val().mobileNumber + '</td> <td>' + snapshot.val().email + '</td> <td><a href="#" data-key="' + key + '" class=" btnEdit"> <button class="btn btn blue-gradient btn-rounded" style = "color:white">Edit</button></a></td></tr>';

        }

        function update_data_table(firstName, lastName, mobileNumber, email) {
            tr.innerHTML = '<td>' + snapshot.val().firstName + '</td><td>' + snapshot.val().lastName + '</td> <td>' + snapshot.val().mobileNumber + '</td> <td>' + snapshot.val().email + '</td <td><a href="#" data-key="' + key + '" class=" btnEdit"> <button class="btn btn blue-gradient btn-rounded" style = "color:white">Edit</button></a></td>';
        }

        function remove_data_table(key) {  // REMOVE FROM DATABASE
            $("#hmd-table #" + key).remove();
        }

        // function new_data(firstName, lastName, key) {
        //     database.ref('approvedProviders/' + key).set({
        //        firstName:firstName,
        //        lastName:lastName

        //     });
        // }

        function update_data(firstName, lastName , mobileNumber, email) {
            database.ref('approvedProviders/' + key).update({
                firstName:firstName,
               lastName:lastName,
               mobileNumber:mobileNumber,
               email:email
            });
        }

        // ADD LIST FROM INPUT BOXES
        // $("#btnAdd").click(function () {
        //     $("#txtfirstname").val("");
        //     $("#txtlastname").val("");
        //     $("#txtgender").val("");
        //     $("#txtnumber").val("");
        //     $("#txtType").val("N");
        //     $("#txtKey").val("0");
        //     $("#modal").addClass("is-active");
        // });


        // SAVE THE ADDED AND EDITED LIST FUNCTION
        $("#btnSave").click(function () {

            if ($("#txtType").val() == 'N') {
                database.ref('approvedProviders/').once("value").then(function (snapshot) {
                    if (snapshot.numChildren() == 0) {
                        nextkey = 1;
                    }
                    new_data($("#txtfirstname").val(), $("#txtlastname").val(), $("#txtMobilenumber").val(), $("#txtemail").val(), nextkey);

                    window.location.reload();
                });
            }
            else {
                update_data($("#txtfirstname").val(), $("#txtlastname").val(), $("#txtMobilenumber").val(), $("#txtemail").val(), $("#txtKey").val());
                window.location.reload();
            }
            $("#btnClose").click();
        });

        // EDIT FUNCTION
        $(document).on("click", ".btnEdit", function (event) {
            event.preventDefault();
            key = $(this).attr("data-key");
            database.ref('approvedProviders/' + key).once("value").then(function (snapshot) {
                $("#txtfirstname").val(snapshot.val().firstName);
                $("#txtlastname").val(snapshot.val().lastName);
                $("#txtMobilenumber").val(snapshot.val().mobileNumber);
                $("#txtemail").val(snapshot.val().email);
                $("#txtType").val("E");
                $("#txtKey").val(key);
            });
            $("#modal").addClass("is-active");
        });


        // REMOVE FUNCTION
        $(document).on("click", "#removeThis", function (event) {
            event.preventDefault();
            key = $(this).attr("data-key");
            database.ref('approvedProviders/' + key).remove();
            $("#modalRemovebox").removeClass("is-active")
        })

        // REMOVE AND  CLASS  POP UP
        $(document).on("click", ".btnClose", function (event) {
            $("#modal").removeClass("is-active");
            $("#modalRemovebox").removeClass("is-active")
        })

        $(document).on("click", ".btnRemove", function (event) {
            $("#modalRemovebox").addClass("is-active")
        })

        // SEARCH FUNCTION
        $(document).ready(function () {
            $("#myInput").on("keyup", function () {
                var value = $(this).val().toLowerCase();
                $("#hmd-table tr").filter(function () {
                    $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
                });
            });
        });	
    </script>


</body>

</html>