<!DOCTYPE html>
<html>

<head>
 	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<meta http-equiv="x-ua-compatible" content="ie=edge">
	<title>House MD</title>
	<!-- Font Awesome -->
	<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.2/css/all.css">
	<!-- Bootstrap core CSS -->
	<link href="css/bootstrap.min.css" rel="stylesheet">
	<!-- Material Design Bootstrap -->
	<link href="css/mdb.min.css" rel="stylesheet">
	<!-- Your custom styles (optional) -->
	<link href="css/style.css" rel="stylesheet">
	<link href="style.css" rel="stylesheet">
	<script src="https://code.jquery.com/jquery-2.1.3.js"
		integrity="sha256-goy7ystDD5xbXSf+kwL4eV6zOPJCEBD1FBiCElIm+U8=" crossorigin="anonymous"></script>
	<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
	<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/vue/2.6.8/vue.min.js"></script>

	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.6.2/css/bulma.min.css">
    <!-- <script defer src="https://use.fontawesome.com/releases/v5.0.0/js/all.js"></script> -->
     <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
<script src="https://cdn.datatables.net/1.10.12/js/jquery.dataTables.min.js"></script>

<link rel="stylesheet" href="https://cdn.datatables.net/1.10.12/css/jquery.dataTables.min.css">
<!-- DataTables CSS -->
<link href="css/addons/datatables.min.css" rel="stylesheet">
<!-- DataTables JS -->
<script href="js/addons/datatables.min.js" rel="stylesheet"></script>

<!-- DataTables Select CSS -->
<link href="css/addons/datatables-select.min.css" rel="stylesheet">
<!-- DataTables Select JS -->
<script href="js/addons/datatables-select.min.js" rel="stylesheet"></script>
<link href="styletab.css" rel="stylesheet">

</head>

<body>


    <header>
        <nav class="navbar fixed-top navbar-expand-lg navbar-dark blue-gradient scrolling-navbar"
            style="position: fixed;">
            <a class="navbar-brand" href="#"><img src="img/dashboard/logo.png" style = "width: 56px;"></a>            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
                aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav mr-auto">
                    <li class="nav-item active">
                        <a class="nav-link" href="#">Home <span class="sr-only">(current)</span></a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">Features</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">Pricing</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">Opinions</a>
                    </li>
                </ul>
                <ul class="navbar-nav nav-flex-icons">
                    <li class="nav-item">
                        <a class="nav-link"><i class="fab fa-facebook-f"></i></a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link"><i class="fab fa-twitter"></i></a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link"><i class="fab fa-instagram"></i></a>
                    </li>
                </ul>
            </div>
        </nav>
    </header>


    <div class="tab">
        <button class="tablinks" onclick="openCity(event, 'London')" id="defaultOpen"> <img src="img/dashboard/jimmy.jpg" style = "width: 45px;height: 39px;border-radius: 44px;"><span style = "margin: 12px;font-size: 16px;">David Grey</span> <a style = " margin: 59px; font-size: 12px;top: -15px; position: relative;">Admin</a></button>
		<a href = "dashboard.html"><button class="tablinks" onclick="openCity(event, 'London')" id="defaultOpen">Dashboard <i class="fas fa-home"></i></button></a>
		<a href = "servicerequest.html"><button class="tablinks" >Providers <i class="fas fa-user-tie"></i></button></a>
        <a href = "members.html"> <button class="tablinks" >Members <i class="fas fa-users"></i></button></a>
        
        <a href = "approved.html"> <button class="tablinks" >Approved Providers</button></a>

        <a href = "transaction.html"><button class="tablinks" >Transaction</button></a>	   <button class="tablinks" >Earnings</button>
	   <a href = "serviceapplication.html"> <button class="tablinks" >Applications</button></a>	  <a href = "service.html"><button class="tablinks">Services</button></a> 
	</div>

    <div id="London" class="tabcontent">
        <button type="button" style = "margin: 19px;border: 2px solid #3e9cdd;" class="btn btn-rounded btn-lg">Service Application<i class="fas fa-scroll"></i></button>
        <p style = "float:right;margin: 30px;color: #bb4242;font-size: 14px;">Application / Service </p>
            <div class="table-responsive card" style ="padding: 30px;">

        <div class="table-responsive">
            <table class="table" id="example">
                <thead class = "blue-gradient">
                    <tr>
                        <th id = "th">Profile</th>
                        <th id = "th">First Name</th>
                        <th id = "th">Last Name</th>
                        <th id = "th">Status</th>
                        <th id = "th">Mobile Number</th>
                        <th id = "th">Email</th>
                        <th id = "th">Accept</th>
                        <th id = "th">Reject</th>
                    </tr>
                </thead>
                <tbody id="hmd-table">

                </tbody>
            </table>
        </div>
    </div>
 </div>
    <!-- <button class="btn btn blue-gradient btn-rounded btnEdit" style="color:white">Add</button></a></td> -->

    <div id="modalRemovebox" class="modal">
        <div class="modal-background"></div>
        <div class="modal-card">
            <header class="modal-card-head">
                <p class="modal-card-title">Do you want to Delete this?</p>
                <button class="btnClose delete" aria-label="close"></button>
            </header>

            <div class="modal-card-foot chums-save">
                <button id="removeThis" class="btn blue-gradient" style="color:white">Yes</button>
                <!-- <button id="btnSavetime" class="button is-success">Save changes</button> -->
                <button id="cancelRemove" class="btn btn-mdb-color" style="color:white">No</button>
            </div>
        </div>
    </div>

    <div id="modal" class="modal"  >
        <div class="modal-background"></div>
        <div class="modal-card">
            <header class="modal-card-head blue-gradient" style = "width: 379px; display: block; margin-left: auto; margin-right: auto;">
                <p class="modal-card-title">Status succesfully change</p>      
            </header>
            <section class="modal-card-body " style = "display:none" >
                <div class="field">
                    <label class="label">Status</label>
                    <div class="control">
                        <input type="hidden" id="txtType">
                        <input type="hidden" id="txtKey">
                        <input class="input" id="txtfirstfirstName" type="text" >
                        <input class="input" id="txtfirstadd" type="text" >
                        <input class="input" id="txtlastName" type="text" >
                        <input class="input" id="txtemail" type="text" >
                        <input class="input" id="txtMobilenumber" type="text" >
                        <input class="input" id="txtapproved" type="text" >
                        <input class="input" id="txtFname" type="text" >
                        <input class="input" id="txtLname" type="text" >

                        <input class="input" id="profilerole" type="text" >
                    </div>
                </div>        
            </section>
            <div class="modal-card-foot chums-save" style = "width: 379px;    display: block; margin-left: auto;margin-right: auto;">
                <button id="btnSave" class="btn blue-gradient btnSaverole btnaddProviders" style="color:white">ok</button>                  
            </div>
        </div>
    </div>



    <!-- The Modal -->
    <div id="myModal" class="modal">
        <!-- Modal content -->
        <div class="modal-content">
            <span class="close">&times;</span>
            <p>Some text in the Modal..</p>
        </div>
    </div>



<script>

		$(document).ready(function(){
  $("#myInput").on("keyup", function() {
    var value = $(this).val().toLowerCase();
    $("#hmd-table tr").filter(function() {
      $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
    });
  });
});	
</script>

   <script src="https://www.gstatic.com/firebasejs/4.12.1/firebase.js"></script>
     <script>
    // Replace your Configuration here..

    var nextkey = 0;
    var config = {
      apiKey: "AIzaSyB-QqOCEreJ1Yn9EWb84NdwJ4E-FvKfC7I",
      authDomain: "edok-1c5a9.firebaseapp.com",
      databaseURL: "https://edok-1c5a9.firebaseio.com",
      projectId: "edok-1c5a9",
      storageBucket: "edok-1c5a9.appspot.com",
      messagingSenderId: "628540937215",
      appId: "1:628540937215:web:6d7ad591c271f0d0394dca",
      measurementId: "G-LH94VM5FTM"
    };
    firebase.initializeApp(config);
  </script>

<script>
    var database = firebase.database();
    database.ref('serviceProviderApplications/').on('child_added', function (snapshot) {
      var data = snapshot.val();
      var key = snapshot.key;
      nexkey = parseInt(key) + 1

      $(document).ready(function () {
        $('#example').DataTable();
        var dataTable = $("#example").dataTable().api();
        tr = document.createElement("tr");
        tr.innerHTML = '<tr ><td><img  style = "width: 40px;height: 30px;border-radius: 48px;" src = ' + snapshot.val().selfiephotoURL + '/></td><td>' + snapshot.val().firstName + '</td><td>' + snapshot.val().lastName + '</td><td>' + snapshot.val().status + '</td> <td>' + snapshot.val().mobileNumber + '</td> <td>' + snapshot.val().email + '</td><td><a href="#" data-key="' + key + '" class=" btnEdit"> <button class="btn btn-outline-primary btn-rounded waves-effect" style = "color:white">Accept</button></a></td><td><a href="#" data-key="' + key + '" class=" btnRemove"> <button class="btn btn-outline-danger btn-rounded waves-effect" style = "color:white" id="myBtn">Reject</button></a></td></tr>';
        dataTable.row.add(tr);
        dataTable.draw();
      });

    });

        database.ref('serviceProviderApplications/').on('child_changed', function (snapshot) {
            update_data_table(snapshot.val().firstName, snapshot.val().lastName, snapshot.val().status, snapshot.val().mobileNumber, snapshot.val().email, data.key)
        });

        database.ref('serviceProviderApplications/').on('child_removed', function (snapshot) {
            remove_data_table(snapshot.key)
        });

        // function add_data_table(selfiePhotoURL, firstName, lastName, status, mobileNumber, email, key) {
        //     $("#hmd-table").append('<tr  id="' + key + '"><td><img style = "width:30px" src = ' + selfiePhotoURL + '/></td><td>' + firstName + '</td><td>' + lastName + '</td><td class = "statusHere">' + status + '</td><td>' + mobileNumber + '</td> <td>' + email + '</td>   <td><a href="#" data-key="' + key + '" class=" btnEdit"> <button class="btn btn-outline-primary btn-rounded waves-effect" style = "color:white">Accept</button></a></td><td><a href="#" data-key="' + key + '" class=" btnRemove"> <button class="btn btn-outline-danger btn-rounded waves-effect" style = "color:white" id="myBtn">Reject</button></a></td></tr>');

        // }

        function update_data_table(firstName, lastName, status, mobileNumber, email) {
      tr.innerHTML = '<tr ><td><img style = "width: 40px;height: 30px;border-radius: 48px;"  src = ' + snapshot.val().photoURL + '/></td><td>' + snapshot.val().firstName + '</td><td>' + snapshot.val().lastName + '</td><td>' + snapshot.val().status + '</td> <td>' + mobileNumber + '</td> <td>' + email + '</td><td><a href="#" data-key="' + key + '" class=" btnEdit"> <button class="btn btn blue-gradient btn-rounded" style = "color:white">Edit</button></a></td></tr>';    
        }


        function remove_data_table(key) {
            $("#hmd-table #" + key).remove();
        }

        function new_data(firstName, lastName, status, mobileNumber, email, key) {
            database.ref('serviceProviderApplications/' + key).set({
                firstName: firstName,
                lastName: lastName,
                status: status,
                mobileNumber: mobileNumber,
                email: email,
            
            });
        }


        function new_data(firstName, lastName, mobileNumber, email) {
            database.ref('approvedProviders/' + key).set({
              firstName:firstName,
              lastName:lastName,
              mobileNumber:mobileNumber,
              email:email
           
          
            });
        }

        function update_data(status) {
            database.ref('serviceProviderApplications/' + key).update({
                status: status,           
            });        
        }

        function update_dataprofile(role) {
            database.ref('profile/' + key).update({
               role:role,           
            });          
        }



        $("#btnAdd").click(function () {
            $("#txtfirstfirstName").val("");
            $("#txtlastfirstName").val("");
            $("#txtgender").val("");
            $("#txtnumber").val("");
            $("#txtType").val("N");
            $("#txtKey").val("0");
            $("#modal").addClass("is-active");

        });


   


        $("#btnSave").click(function () {
            if ($("#txtType").val() == 'N') {
                database.ref('serviceProviderApplications/').once("value").then(function (snapshot) {
                    if (snapshot.numChildren() == 0) {
                        nextkey = 1;
                    }
                // new_data($("#txtfirstfirstName").val(), $("#txtlastfirstName").val(), $("#txtgender").val(), $("#txtaddress").val(), $("#txtnumber").val(), nextkey);

                    window.location.reload();
                });
            }
            else {
                update_data($("#txtapproved").val());
                window.location.reload();

            }
            $("#btnClose").click();
        });


        $(".btnSaverole").click(function () {
            if ($("#txtType").val() == 'N') {
              database.ref('profile/').once("value").then(function (snapshot) {
             if (snapshot.numChildren() == 0) {
            nextkey = 1;
          }
          new_data($("#txtapproved").val(), $("#txtgender").val(), $("#txtaddress").val(), $("#txtnumber").val(), nextkey);
        window.location.reload();
    });

}
else {
    update_dataprofile($("#profilerole").val());
    window.location.reload();
}
$("#btnClose").click();
});



$(".btnaddProviders").click(function () {
    if ($("#txtType").val() == 'N') {
                database.ref('approvedProviders/').once("value").then(function (snapshot) {
                    if (snapshot.numChildren() == 0) {
                        nextkey = 1;
                    }
                    new_data($("#txtfirstadd").val(), $("#txtlastName").val(),$("#txtMobilenumber").val(),$("#txtemail").val(), nextkey);


                    // window.location.reload();
                });
            }
            else {
                // update_data($("#txtfirstfirstName").val());
                // window.location.reload();
                new_data($("#txtfirstadd").val(), $("#txtlastName").val(),$("#txtMobilenumber").val(),$("#txtemail").val(), nextkey);

            }
            $("#btnClose").click();
$("#btnClose").click();
});



// UPDATE STATUS AND ROLE IN PROFILE AND APPLICATION

$(document).on("click", ".btnEdit", function (event) {
            event.preventDefault();
            key = $(this).attr("data-key");
        database.ref('serviceProviderApplications/' + key).once("value").then(function (snapshot) {
            $("#txtfirstfirstName").val("approved");
                $("#txtfirstadd").val(snapshot.val().firstName);
                $("#txtlastName").val(snapshot.val().lastName);
                $("#txtMobilenumber").val(snapshot.val().mobileNumber);
                $("#txtemail").val(snapshot.val().email);
                $("#txtapproved").val("approved");

                $("#txtType").val("E");
                $("#txtKey").val(key);
            });

        database.ref('profile/' + key).once("value").then(function (snapshot) {
            $("#profilerole").val("provider");
            $("#txtType").val("E");
            $("#txtKey").val(key);
          });  

          $("#modal").addClass("is-active");           
        });


        // $(document).on("click", ".btnEdit", function (event) {
        //     event.preventDefault();
        //     key = $(this).attr("data-key");
        // database.ref('serviceProviderApplications/' + key).once("value").then(function (snapshot) {
        //         $("#txtfirstfirstName").val("approved");
        //         $("#txtType").val("E");
        //         $("#txtKey").val(key);
        //     });

        // database.ref('profile/' + key).once("value").then(function (snapshot) {
        //     $("#profilerole").val("provider");
        //     $("#txtType").val("E");
        //     $("#txtKey").val(key);
        //   });


          
        //     $("#modal").addClass("is-active");
            
        // });


        $(document).on("click", "#removeThis", function (event) {
            event.preventDefault();
            key = $(this).attr("data-key");
            database.ref('services/' + key).remove();
            $("#modalRemovebox").removeClass("is-active")
        })

        // $(document).on("click", ".btnRemove", function (event) {
        //     $("#modalRemovebox").addClass("is-active")
        // })

    </script>

</body>

</html>